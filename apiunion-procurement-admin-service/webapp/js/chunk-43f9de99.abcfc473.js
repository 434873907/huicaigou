(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-43f9de99"],{"09d3":function(t,e,a){},2223:function(t,e,a){"use strict";a.r(e);var s=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"send-coupon"},[a("h2",{staticClass:"coupon-title"},[t._v("发劵")]),a("div",{staticClass:"coupon-box"},[a("div",{staticClass:"coupon"},[a("span",{staticClass:"title"},[t._v("当前优惠劵："+t._s(t.name))])]),a("div",{staticClass:"coupon choice-select"},[a("span",{staticClass:"title"},[t._v("请加入用户：")]),a("el-radio-group",{on:{change:t.choiceSelect},model:{value:t.choiceType,callback:function(e){t.choiceType=e},expression:"choiceType"}},[a("el-radio",{attrs:{label:0}},[t._v("全部用户")]),a("el-radio",{attrs:{label:1}},[t._v("部分用户")])],1)],1)]),a("div",{staticClass:"coupon-titles"},[a("span",{staticClass:"num"},[t._v("已选用户（"+t._s(t.saveChoiceList.length)+"）")])]),1==t.choiceType?a("div",{staticClass:"choice-user"},[a("div",{staticClass:"taps"},[t._e()]),a("div",{staticClass:"search-bar"},[a("span",{staticClass:"search-bar-title"},[t._v("一般筛选:")]),a("span",{staticClass:"normal-title"},[t._v("用户信息：")]),a("input",{directives:[{name:"model",rawName:"v-model",value:t.listParams.name,expression:"listParams.name"}],staticClass:"form-control",attrs:{type:"text",placeholder:"请输入用户名"},domProps:{value:t.listParams.name},on:{input:function(e){e.target.composing||t.$set(t.listParams,"name",e.target.value)}}}),a("a",{staticClass:"btn-fill-main",attrs:{href:"javascript:;"},on:{click:function(e){return t.getList()}}},[t._v("搜索")]),t._e()]),a("table",{staticClass:"table table-text"},[a("thead",[a("tr",[a("th",{staticClass:"dot",class:{active:t.checkAll},on:{click:function(e){return t.selectAll()}}}),a("th",{staticClass:"table-w180"},[t._v("用户昵称")]),a("th",{staticClass:"table-w120"},[t._v("手机号")]),a("th",{staticClass:"table-w100"},[t._v("会员类型")]),a("th",{staticClass:"table-w180"},[t._v("注册时间")]),a("th")])]),a("tbody",t._l(t.tableData,function(e,s){return a("tr",{key:s,on:{click:function(a){return t.selectItem(e,s)}}},[a("td",{staticClass:"dot",class:{active:e.checked}}),a("td",[t._v("\n                           "+t._s(e.userName)+"\n                        ")]),a("td",[t._v(t._s(e.userPhone))]),a("td",[t._v(t._s(e.userType))]),a("td",[t._v(t._s(e.registerTime))]),a("td")])}),0)]),a("pagination",{directives:[{name:"show",rawName:"v-show",value:t.total>0,expression:"total>0"}],attrs:{total:t.total,page:t.listParams.page,limit:t.listParams.limit},on:{"update:page":function(e){return t.$set(t.listParams,"page",e)},"update:limit":function(e){return t.$set(t.listParams,"limit",e)},pagination:function(e){return t.getList()}}}),0===t.total?a("noData"):t._e()],1):t._e(),a("div",{staticClass:"control-box"},[a("a",{staticClass:"btn-fill-main",attrs:{href:"javascript:;"},on:{click:t.cancel}},[t._v("取消")]),a("a",{staticClass:"btn-fill-main btn-main",attrs:{href:"javascript:;"},on:{click:t.confirm}},[t._v("确定")])]),a("el-dialog",{attrs:{title:"发劵:",visible:t.showSendModal,width:"468px","close-on-click-modal":!1},on:{"update:visible":function(e){t.showSendModal=e}}},[a("div",{staticClass:"dialog-form export-dialog"},[a("el-progress",{attrs:{"text-inside":!0,"stroke-width":14,percentage:t.sendProgress,color:"#F06941"}})],1),a("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("button",{staticClass:"btn-fill-grey-main",on:{click:function(e){t.showSendModal=!1}}},[t._v("取消")]),a("a",{directives:[{name:"show",rawName:"v-show",value:!t.sendKey,expression:"!sendKey"}],staticClass:"btn-main",attrs:{href:"javascript:;"},on:{click:t.sendCoupon}},[t._v("开始发劵")]),a("a",{directives:[{name:"show",rawName:"v-show",value:t.sendKey,expression:"sendKey"}],staticClass:"btn-main",attrs:{href:"javascript:;"},on:{click:function(e){t.showSendModal=!1,t.downloadOrder()}}},[t._v("点击下载")]),t._e()])])],1)},i=[],n=(a("7f7f"),a("4d86")),o=a("4162"),c={name:"sendCoupon",components:{Pagination:n["a"],noData:o["a"]},data:function(){return{choiceType:1,tableData:[],total:1,checkAll:!1,listParams:{page:1,limit:10,name:""},name:"",id:"",showSendModal:!1,sendProgress:0,sendKey:"",saveChoiceList:[]}},computed:{choiceList:function(){var t=this.tableData,e=t.filter(function(t){return 1==t.checked})||[];return e||[]}},created:function(){this.id=this.$route.params.id||"",this.name=this.$route.params.name||"",this.getList()},methods:{choiceSelect:function(t){this.choiceType=t},getList:function(){var t=this,e=this.listParams;this.checkAll=!1,this.api.consumer.user(e).then(function(e){if(e.success){var a=e.data&&e.data.dataList||[];a=a.map(function(t){return t.checked=!1,t})||[],t.tableData=a||[],t.doChangeDateList(),t.total=e.data.total||0}else t.toast(e.message)})},selectAll:function(){var t=this;this.checkAll=!this.checkAll;var e=this.tableData;e=e.map(function(e){return t.checkAll?e.checked=!0:e.checked=!1,e})||[],this.tableData=e,this.doControlAll(this.checkAll)},doControlAll:function(){var t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],e=this.saveChoiceList,a=this.tableData;if(console.log(a),console.log(e),t){for(var s=0;s<a.length;s++){for(var i=!1,n=0;n<e.length;n++)e[n].userId==a[s].userId&&(i=!0);i||e.push(a[s])}this.saveChoiceList=e}else{for(var o=[],c=0;c<e.length;c++){for(var r=!1,l=0;l<a.length;l++)a[l].userId==e[c].userId&&(r=!0);r||o.push(e[c])}this.saveChoiceList=o}},doChangeDateList:function(){var t=this.saveChoiceList,e=this.tableData;if(t.length){for(var a=0;a<e.length;a++){for(var s=!1,i=0;i<t.length;i++)t[i].userId==e[a].userId&&(s=!0);e[a].checked=!!s}this.tableData=e}else this.tableData=e},selectItem:function(t,e){t.checked=!t.checked||!1,this.$set(this.tableData,e,t);var a=this.saveChoiceList,s=[];if(a.length){for(var i=!1,n=0;n<a.length;n++)a[n].userId==t.userId?i=!0:s.push(a[n]);i||s.push(t)}else t.checked&&s.push(t);this.saveChoiceList=s},cancel:function(){this.$router.go(-1)},confirm:function(){var t=this.choiceType,e=this.saveChoiceList;if(0==t)this.showSendModal=!0;else{if(0==e.length)return void this.$message.error("请选择用户");this.showSendModal=!0}},sendCoupon:function(){var t=this,e=this.choiceType,a=this.saveChoiceList,s=this.id,i={};if(0==e)i={couponConfigId:s,selectType:1};else{var n=a.map(function(t){var e=t.userId;return e})||[];i={couponConfigId:s,selectType:2,userIds:String(n)}}this.api.coupon.sendCoupon(i).then(function(e){if(e.success)var a=e.data,s=setInterval(function(){t.api.progress.rate({data:a}).then(function(e){e.success?e.data.finished?(t.sendProgress=e.data.percent,t.sendKey=a,clearInterval(s)):t.sendProgress=e.data.percent:(t.$message.info({message:e.message,showClose:!0}),t.sendProgress=0,clearInterval(s))})},1e3);else t.$message.info(e.message)})},downloadOrder:function(){window.open("/common/progress_result.do?data="+this.sendKey,"_blank")}},watch:{showSendModal:function(t){t||(this.sendKey="",this.sendProgress=0)}}},r=c,l=(a("cadd"),a("2877")),u=Object(l["a"])(r,s,i,!1,null,"b00ecf80",null);e["default"]=u.exports},4162:function(t,e,a){"use strict";var s=function(){var t=this,e=t.$createElement;t._self._c;return t._m(0)},i=[function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"no-data"},[s("img",{attrs:{src:a("ce64")}})])}],n={data:function(){return{}}},o=n,c=(a("c11a"),a("2877")),r=Object(c["a"])(o,s,i,!1,null,"30043eae",null);e["a"]=r.exports},"4d86":function(t,e,a){"use strict";var s=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"pagination-container",class:{hidden:t.hidden}},[a("el-pagination",t._b({attrs:{background:t.background,"current-page":t.currentPage,"page-size":t.pageSize,layout:t.layout,total:t.total},on:{"update:currentPage":function(e){t.currentPage=e},"update:current-page":function(e){t.currentPage=e},"update:pageSize":function(e){t.pageSize=e},"update:page-size":function(e){t.pageSize=e},"size-change":t.handleSizeChange,"current-change":t.handleCurrentChange}},"el-pagination",t.$attrs,!1))],1)},i=[],n=(a("c5f6"),{name:"Pagination",props:{total:{required:!0,type:Number},page:{type:Number,default:1},limit:{type:Number,default:20},pageSizes:{type:Array,default:function(){return[10,20,30,50]}},layout:{type:String,default:"total, sizes, prev, pager, next, jumper"},background:{type:Boolean,default:!0},autoScroll:{type:Boolean,default:!0},hidden:{type:Boolean,default:!1}},computed:{currentPage:{get:function(){return this.page},set:function(t){this.$emit("update:page",t)}},pageSize:{get:function(){return this.limit},set:function(t){this.$emit("update:limit",t)}}},methods:{handleSizeChange:function(t){this.$emit("pagination",{page:this.currentPage,limit:t}),this.autoScroll},handleCurrentChange:function(t){this.$emit("pagination",{page:t,limit:this.pageSize}),this.autoScroll}}}),o=n,c=(a("b02f"),a("2877")),r=Object(c["a"])(o,s,i,!1,null,"6494eb3e",null);e["a"]=r.exports},"850a":function(t,e,a){},b02f:function(t,e,a){"use strict";var s=a("09d3"),i=a.n(s);i.a},c11a:function(t,e,a){"use strict";var s=a("dded"),i=a.n(s);i.a},cadd:function(t,e,a){"use strict";var s=a("850a"),i=a.n(s);i.a},ce64:function(t,e,a){t.exports=a.p+"img/noData.e2799484.png"},dded:function(t,e,a){}}]);
//# sourceMappingURL=chunk-43f9de99.abcfc473.js.map